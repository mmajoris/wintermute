{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 43, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelmajoris/wintermute/lib/event-buffer.ts"],"sourcesContent":["/**\n * Circular Event Buffer\n * \n * In-memory buffer for storing recent brain events.\n * Used by the API endpoint to store events and by WebSocket to send history.\n */\n\nimport type { BrainEvent, BrainEventEnvelope } from \"./brain-events\";\n\nexport class EventBuffer {\n  private buffer: BrainEventEnvelope[] = [];\n  private maxSize: number;\n  private eventCounter = 0;\n\n  constructor(maxSize = 1000) {\n    this.maxSize = maxSize;\n  }\n\n  push(event: BrainEvent): BrainEventEnvelope {\n    const envelope: BrainEventEnvelope = {\n      id: `evt_${Date.now()}_${++this.eventCounter}`,\n      event,\n      received_at: new Date().toISOString(),\n    };\n\n    this.buffer.push(envelope);\n\n    if (this.buffer.length > this.maxSize) {\n      this.buffer.shift();\n    }\n\n    return envelope;\n  }\n\n  getRecent(count = 100): BrainEventEnvelope[] {\n    return this.buffer.slice(-count);\n  }\n\n  getAll(): BrainEventEnvelope[] {\n    return [...this.buffer];\n  }\n\n  getByType(type: BrainEvent[\"type\"], count = 50): BrainEventEnvelope[] {\n    return this.buffer\n      .filter((e) => e.event.type === type)\n      .slice(-count);\n  }\n\n  getSince(timestamp: string): BrainEventEnvelope[] {\n    const since = new Date(timestamp).getTime();\n    return this.buffer.filter(\n      (e) => new Date(e.received_at).getTime() > since\n    );\n  }\n\n  clear(): void {\n    this.buffer = [];\n  }\n\n  get size(): number {\n    return this.buffer.length;\n  }\n\n  get eventsPerSecond(): number {\n    if (this.buffer.length < 2) return 0;\n    \n    const recent = this.buffer.slice(-100);\n    if (recent.length < 2) return 0;\n\n    const first = new Date(recent[0].received_at).getTime();\n    const last = new Date(recent[recent.length - 1].received_at).getTime();\n    const durationSeconds = (last - first) / 1000;\n\n    if (durationSeconds <= 0) return 0;\n    return recent.length / durationSeconds;\n  }\n}\n\nlet globalBuffer: EventBuffer | null = null;\n\nexport function getGlobalEventBuffer(): EventBuffer {\n  if (!globalBuffer) {\n    globalBuffer = new EventBuffer(1000);\n  }\n  return globalBuffer;\n}\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;;;AAIM,MAAM;IACH,SAA+B,EAAE,CAAC;IAClC,QAAgB;IAChB,eAAe,EAAE;IAEzB,YAAY,UAAU,IAAI,CAAE;QAC1B,IAAI,CAAC,OAAO,GAAG;IACjB;IAEA,KAAK,KAAiB,EAAsB;QAC1C,MAAM,WAA+B;YACnC,IAAI,CAAC,IAAI,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,YAAY,EAAE;YAC9C;YACA,aAAa,IAAI,OAAO,WAAW;QACrC;QAEA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;QAEjB,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,EAAE;YACrC,IAAI,CAAC,MAAM,CAAC,KAAK;QACnB;QAEA,OAAO;IACT;IAEA,UAAU,QAAQ,GAAG,EAAwB;QAC3C,OAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IAC5B;IAEA,SAA+B;QAC7B,OAAO;eAAI,IAAI,CAAC,MAAM;SAAC;IACzB;IAEA,UAAU,IAAwB,EAAE,QAAQ,EAAE,EAAwB;QACpE,OAAO,IAAI,CAAC,MAAM,CACf,MAAM,CAAC,CAAC,IAAM,EAAE,KAAK,CAAC,IAAI,KAAK,MAC/B,KAAK,CAAC,CAAC;IACZ;IAEA,SAAS,SAAiB,EAAwB;QAChD,MAAM,QAAQ,IAAI,KAAK,WAAW,OAAO;QACzC,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CACvB,CAAC,IAAM,IAAI,KAAK,EAAE,WAAW,EAAE,OAAO,KAAK;IAE/C;IAEA,QAAc;QACZ,IAAI,CAAC,MAAM,GAAG,EAAE;IAClB;IAEA,IAAI,OAAe;QACjB,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM;IAC3B;IAEA,IAAI,kBAA0B;QAC5B,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,OAAO;QAEnC,MAAM,SAAS,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAClC,IAAI,OAAO,MAAM,GAAG,GAAG,OAAO;QAE9B,MAAM,QAAQ,IAAI,KAAK,MAAM,CAAC,EAAE,CAAC,WAAW,EAAE,OAAO;QACrD,MAAM,OAAO,IAAI,KAAK,MAAM,CAAC,OAAO,MAAM,GAAG,EAAE,CAAC,WAAW,EAAE,OAAO;QACpE,MAAM,kBAAkB,CAAC,OAAO,KAAK,IAAI;QAEzC,IAAI,mBAAmB,GAAG,OAAO;QACjC,OAAO,OAAO,MAAM,GAAG;IACzB;AACF;AAEA,IAAI,eAAmC;AAEhC,SAAS;IACd,IAAI,CAAC,cAAc;QACjB,eAAe,IAAI,YAAY;IACjC;IACA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 116, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelmajoris/wintermute/lib/sse-clients.ts"],"sourcesContent":["/**\n * SSE Client Manager\n * \n * Manages Server-Sent Events clients for broadcasting brain events.\n */\n\nimport type { BrainEventEnvelope } from \"./brain-events\";\n\ntype SSEClient = {\n  id: string;\n  controller: ReadableStreamDefaultController;\n  encoder: TextEncoder;\n};\n\nconst clients = new Map<string, SSEClient>();\nlet clientCounter = 0;\n\nexport function addSSEClient(\n  controller: ReadableStreamDefaultController,\n  encoder: TextEncoder\n): string {\n  const id = `sse_${Date.now()}_${++clientCounter}`;\n  clients.set(id, { id, controller, encoder });\n  return id;\n}\n\nexport function removeSSEClient(id: string): void {\n  clients.delete(id);\n}\n\nexport function broadcastToSSEClients(envelope: BrainEventEnvelope): void {\n  const message = `data: ${JSON.stringify({ type: \"brain_event\", data: envelope })}\\n\\n`;\n\n  const deadClients: string[] = [];\n\n  for (const [id, client] of clients) {\n    try {\n      client.controller.enqueue(client.encoder.encode(message));\n    } catch {\n      deadClients.push(id);\n    }\n  }\n\n  for (const id of deadClients) {\n    clients.delete(id);\n  }\n}\n\nexport function getSSEClientCount(): number {\n  return clients.size;\n}\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;;;;;;;AAUD,MAAM,UAAU,IAAI;AACpB,IAAI,gBAAgB;AAEb,SAAS,aACd,UAA2C,EAC3C,OAAoB;IAEpB,MAAM,KAAK,CAAC,IAAI,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,EAAE,eAAe;IACjD,QAAQ,GAAG,CAAC,IAAI;QAAE;QAAI;QAAY;IAAQ;IAC1C,OAAO;AACT;AAEO,SAAS,gBAAgB,EAAU;IACxC,QAAQ,MAAM,CAAC;AACjB;AAEO,SAAS,sBAAsB,QAA4B;IAChE,MAAM,UAAU,CAAC,MAAM,EAAE,KAAK,SAAS,CAAC;QAAE,MAAM;QAAe,MAAM;IAAS,GAAG,IAAI,CAAC;IAEtF,MAAM,cAAwB,EAAE;IAEhC,KAAK,MAAM,CAAC,IAAI,OAAO,IAAI,QAAS;QAClC,IAAI;YACF,OAAO,UAAU,CAAC,OAAO,CAAC,OAAO,OAAO,CAAC,MAAM,CAAC;QAClD,EAAE,OAAM;YACN,YAAY,IAAI,CAAC;QACnB;IACF;IAEA,KAAK,MAAM,MAAM,YAAa;QAC5B,QAAQ,MAAM,CAAC;IACjB;AACF;AAEO,SAAS;IACd,OAAO,QAAQ,IAAI;AACrB","debugId":null}},
    {"offset": {"line": 168, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelmajoris/wintermute/app/api/brain-events/stream/route.ts"],"sourcesContent":["import { NextRequest } from \"next/server\";\nimport { getGlobalEventBuffer } from \"@/lib/event-buffer\";\nimport { addSSEClient, removeSSEClient } from \"@/lib/sse-clients\";\n\nexport const runtime = \"nodejs\";\nexport const dynamic = \"force-dynamic\";\n\nexport async function GET(request: NextRequest) {\n  const buffer = getGlobalEventBuffer();\n  const encoder = new TextEncoder();\n\n  const stream = new ReadableStream({\n    start(controller) {\n      const clientId = addSSEClient(controller, encoder);\n\n      const history = buffer.getRecent(100);\n      const historyMessage = `data: ${JSON.stringify({ type: \"history\", data: history })}\\n\\n`;\n      controller.enqueue(encoder.encode(historyMessage));\n\n      const keepalive = setInterval(() => {\n        try {\n          controller.enqueue(encoder.encode(`: keepalive\\n\\n`));\n        } catch {\n          clearInterval(keepalive);\n        }\n      }, 30000);\n\n      request.signal.addEventListener(\"abort\", () => {\n        clearInterval(keepalive);\n        removeSSEClient(clientId);\n        try {\n          controller.close();\n        } catch {\n          // Already closed\n        }\n      });\n    },\n    cancel() {\n      // Client disconnected\n    },\n  });\n\n  return new Response(stream, {\n    headers: {\n      \"Content-Type\": \"text/event-stream\",\n      \"Cache-Control\": \"no-cache, no-transform\",\n      Connection: \"keep-alive\",\n      \"X-Accel-Buffering\": \"no\",\n    },\n  });\n}\n"],"names":[],"mappings":";;;;;;;;AACA;AACA;;;AAEO,MAAM,UAAU;AAChB,MAAM,UAAU;AAEhB,eAAe,IAAI,OAAoB;IAC5C,MAAM,SAAS,IAAA,gJAAoB;IACnC,MAAM,UAAU,IAAI;IAEpB,MAAM,SAAS,IAAI,eAAe;QAChC,OAAM,UAAU;YACd,MAAM,WAAW,IAAA,uIAAY,EAAC,YAAY;YAE1C,MAAM,UAAU,OAAO,SAAS,CAAC;YACjC,MAAM,iBAAiB,CAAC,MAAM,EAAE,KAAK,SAAS,CAAC;gBAAE,MAAM;gBAAW,MAAM;YAAQ,GAAG,IAAI,CAAC;YACxF,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC;YAElC,MAAM,YAAY,YAAY;gBAC5B,IAAI;oBACF,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC,CAAC,eAAe,CAAC;gBACrD,EAAE,OAAM;oBACN,cAAc;gBAChB;YACF,GAAG;YAEH,QAAQ,MAAM,CAAC,gBAAgB,CAAC,SAAS;gBACvC,cAAc;gBACd,IAAA,0IAAe,EAAC;gBAChB,IAAI;oBACF,WAAW,KAAK;gBAClB,EAAE,OAAM;gBACN,iBAAiB;gBACnB;YACF;QACF;QACA;QACE,sBAAsB;QACxB;IACF;IAEA,OAAO,IAAI,SAAS,QAAQ;QAC1B,SAAS;YACP,gBAAgB;YAChB,iBAAiB;YACjB,YAAY;YACZ,qBAAqB;QACvB;IACF;AACF","debugId":null}}]
}