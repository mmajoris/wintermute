{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelmajoris/wintermute/auth.ts"],"sourcesContent":["import NextAuth from \"next-auth\";\nimport Credentials from \"next-auth/providers/credentials\";\nimport { compare } from \"bcryptjs\";\n\nconst ALLOWED_EMAIL = process.env.AUTH_ALLOWED_EMAIL;\n// Workaround: Next.js dotenv-expand interprets $ as variable expansion\n// So we store the hash as base64 and decode it here\nconst PASSWORD_HASH_B64 = process.env.AUTH_PASSWORD_HASH_B64;\nconst PASSWORD_HASH = PASSWORD_HASH_B64 \n  ? Buffer.from(PASSWORD_HASH_B64, 'base64').toString('utf-8')\n  : undefined;\nconst ALLOWED_IPS = process.env.AUTH_ALLOWED_IPS?.split(\",\").map((ip) => ip.trim()) ?? [];\n\nexport const { handlers, signIn, signOut, auth } = NextAuth({\n  providers: [\n    Credentials({\n      name: \"Password\",\n      credentials: {\n        email: { label: \"Email\", type: \"email\" },\n        password: { label: \"Password\", type: \"password\" },\n      },\n      async authorize(credentials, request) {\n        const email = credentials?.email as string;\n        const password = credentials?.password as string;\n\n        if (!email || !password) {\n          return null;\n        }\n\n        if (ALLOWED_EMAIL && email !== ALLOWED_EMAIL) {\n          console.warn(`[auth] Rejected login attempt for: ${email}`);\n          return null;\n        }\n\n        if (!PASSWORD_HASH) {\n          console.error(\"[auth] AUTH_PASSWORD_HASH not configured\");\n          return null;\n        }\n\n        const isValid = await compare(password, PASSWORD_HASH);\n        if (!isValid) {\n          console.warn(`[auth] Invalid password for: ${email}`);\n          return null;\n        }\n\n        // IP check (if configured)\n        if (ALLOWED_IPS.length > 0) {\n          const forwarded = request?.headers?.get?.(\"x-forwarded-for\");\n          const realIp = request?.headers?.get?.(\"x-real-ip\");\n          const clientIp = forwarded?.split(\",\")[0]?.trim() || realIp || \"unknown\";\n\n          if (!ALLOWED_IPS.includes(clientIp) && clientIp !== \"unknown\") {\n            console.warn(`[auth] IP not in allowlist: ${clientIp}`);\n            // Don't block, just log - IP detection can be unreliable\n          }\n        }\n\n        return {\n          id: \"1\",\n          email: email,\n          name: \"Admin\",\n        };\n      },\n    }),\n  ],\n  pages: {\n    signIn: \"/login\",\n    error: \"/login\",\n  },\n  callbacks: {\n    authorized({ auth, request }) {\n      const isLoggedIn = !!auth?.user;\n      const isOnProtectedRoute =\n        request.nextUrl.pathname.startsWith(\"/explorer\") ||\n        request.nextUrl.pathname.startsWith(\"/live\") ||\n        request.nextUrl.pathname.startsWith(\"/api/brain-events/stream\");\n\n      if (isOnProtectedRoute) {\n        return isLoggedIn;\n      }\n\n      return true;\n    },\n  },\n  session: {\n    strategy: \"jwt\",\n    maxAge: 7 * 24 * 60 * 60, // 7 days\n  },\n  trustHost: true,\n});\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AAAA;AACA;;;;AAEA,MAAM,gBAAgB,QAAQ,GAAG,CAAC,kBAAkB;AACpD,uEAAuE;AACvE,oDAAoD;AACpD,MAAM,oBAAoB,QAAQ,GAAG,CAAC,sBAAsB;AAC5D,MAAM,gBAAgB,oBAClB,OAAO,IAAI,CAAC,mBAAmB,UAAU,QAAQ,CAAC,WAClD;AACJ,MAAM,cAAc,QAAQ,GAAG,CAAC,gBAAgB,EAAE,MAAM,KAAK,IAAI,CAAC,KAAO,GAAG,IAAI,OAAO,EAAE;AAElF,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,IAAA,kKAAQ,EAAC;IAC1D,WAAW;QACT,IAAA,uKAAW,EAAC;YACV,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW,EAAE,OAAO;gBAClC,MAAM,QAAQ,aAAa;gBAC3B,MAAM,WAAW,aAAa;gBAE9B,IAAI,CAAC,SAAS,CAAC,UAAU;oBACvB,OAAO;gBACT;gBAEA,IAAI,iBAAiB,UAAU,eAAe;oBAC5C,QAAQ,IAAI,CAAC,CAAC,mCAAmC,EAAE,OAAO;oBAC1D,OAAO;gBACT;gBAEA,IAAI,CAAC,eAAe;oBAClB,QAAQ,KAAK,CAAC;oBACd,OAAO;gBACT;gBAEA,MAAM,UAAU,MAAM,IAAA,8IAAO,EAAC,UAAU;gBACxC,IAAI,CAAC,SAAS;oBACZ,QAAQ,IAAI,CAAC,CAAC,6BAA6B,EAAE,OAAO;oBACpD,OAAO;gBACT;gBAEA,2BAA2B;gBAC3B,IAAI,YAAY,MAAM,GAAG,GAAG;oBAC1B,MAAM,YAAY,SAAS,SAAS,MAAM;oBAC1C,MAAM,SAAS,SAAS,SAAS,MAAM;oBACvC,MAAM,WAAW,WAAW,MAAM,IAAI,CAAC,EAAE,EAAE,UAAU,UAAU;oBAE/D,IAAI,CAAC,YAAY,QAAQ,CAAC,aAAa,aAAa,WAAW;wBAC7D,QAAQ,IAAI,CAAC,CAAC,4BAA4B,EAAE,UAAU;oBACtD,yDAAyD;oBAC3D;gBACF;gBAEA,OAAO;oBACL,IAAI;oBACJ,OAAO;oBACP,MAAM;gBACR;YACF;QACF;KACD;IACD,OAAO;QACL,QAAQ;QACR,OAAO;IACT;IACA,WAAW;QACT,YAAW,EAAE,IAAI,EAAE,OAAO,EAAE;YAC1B,MAAM,aAAa,CAAC,CAAC,MAAM;YAC3B,MAAM,qBACJ,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,gBACpC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,YACpC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;YAEtC,IAAI,oBAAoB;gBACtB,OAAO;YACT;YAEA,OAAO;QACT;IACF;IACA,SAAS;QACP,UAAU;QACV,QAAQ,IAAI,KAAK,KAAK;IACxB;IACA,WAAW;AACb","debugId":null}},
    {"offset": {"line": 159, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelmajoris/wintermute/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import { handlers } from \"@/auth\";\n\nexport const { GET, POST } = handlers;\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,kHAAQ","debugId":null}}]
}