"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[327],{2587:(e,n,t)=>{t.d(n,{DR:()=>r,Jj:()=>s,Px:()=>l});var a=t(5339);function r(e){let{vertices:n,normals:t,faces:r}=e.model,l=[],s=[],i=0;for(;i<r.length;){let e=r[i++],a=!!(1&e),o=!!(2&e),c=!!(8&e),u=!!(32&e),d=!!(128&e),p=a?4:3,m=[];for(let e=0;e<p;e++)m.push(r[i++]);o&&i++;let x=[];if(c&&(i+=p),u)for(let e=0;e<p;e++)x.push(r[i++]);for(let e of(d&&(i+=p),a?[[0,1,2],[0,2,3]]:[[0,1,2]]))for(let a of e){let e=m[a];if(l.push(n[3*e],n[3*e+1],n[3*e+2]),x.length>0){let e=x[a];s.push(t[3*e],t[3*e+1],t[3*e+2])}else s.push(t[3*e],t[3*e+1],t[3*e+2])}}let o=new a.LoY;return o.setAttribute("position",new a.qtW(l,3)),o.setAttribute("normal",new a.qtW(s,3)),o}let l=[{id:"left-hemisphere",name:"Left Hemisphere",file:"Brain-cerebral_hemisphere-left.json",parent:null,color:"#6366f1",opacity:.3,category:"cerebrum"},{id:"right-hemisphere",name:"Right Hemisphere",file:"Brain-cerebral_hemisphere-right.json",parent:null,color:"#818cf8",opacity:.3,category:"cerebrum"},{id:"cerebellum",name:"Cerebellum",file:"Brain-cerebellum.json",parent:null,color:"#8b5cf6",opacity:.55,category:"cerebellum"},{id:"midbrain",name:"Midbrain",file:"Brain-brain_stem-midbrain.json",parent:null,color:"#ec4899",opacity:.6,category:"brainstem"},{id:"pons",name:"Pons",file:"Brain-brain_stem-pons.json",parent:null,color:"#f472b6",opacity:.6,category:"brainstem"},{id:"medulla",name:"Medulla Oblongata",file:"Brain-brain_stem-medulla_oblongata.json",parent:null,color:"#db2777",opacity:.6,category:"brainstem"},{id:"hippocampus",name:"Hippocampus",file:"Brain-limbic_system-hippocampus-hippocampus.json",parent:null,color:"#f97316",opacity:.75,category:"limbic"},{id:"amygdala",name:"Amygdala",file:"Brain-limbic_system-amygdala.json",parent:null,color:"#ef4444",opacity:.75,category:"limbic"},{id:"hypothalamus",name:"Hypothalamus",file:"Brain-limbic_system-hypothalamus.json",parent:null,color:"#f59e0b",opacity:.75,category:"limbic"},{id:"entorhinal-cortex",name:"Entorhinal Cortex",file:"Brain-limbic_system-entorhinal_cortex.json",parent:null,color:"#fb923c",opacity:.7,category:"limbic"},{id:"dentate-gyrus",name:"Dentate Gyrus",file:"Brain-limbic_system-hippocampus-dentate_gyrus.json",parent:null,color:"#fdba74",opacity:.7,category:"limbic"},{id:"subiculum",name:"Subiculum",file:"Brain-limbic_system-hippocampus-subiculum.json",parent:null,color:"#fed7aa",opacity:.65,category:"limbic"},{id:"thalamus",name:"Thalamus",file:"Brain-thalamus.json",parent:null,color:"#f97316",opacity:.65,category:"limbic"},{id:"corpus-callosum",name:"Corpus Callosum",file:"Brain-corpus_callosum.json",parent:null,color:"#e2e8f0",opacity:.4,category:"cerebrum"},{id:"ventricles",name:"Ventricles",file:"Brain-ventricles.json",parent:null,color:"#38bdf8",opacity:.3,category:"organ"},{id:"pituitary",name:"Pituitary Gland",file:"Brain-pituitary_gland.json",parent:null,color:"#fbbf24",opacity:.7,category:"endocrine"},{id:"olfactory-bulb",name:"Olfactory Bulb",file:"Brain-olfactory_bulb.json",parent:null,color:"#a3e635",opacity:.65,category:"peripheral"},{id:"auditory-cortex",name:"Primary Auditory Cortex",file:"Brain-primary_auditory_cortex.json",parent:null,color:"#2dd4bf",opacity:.65,category:"cerebrum"},{id:"caudate-nucleus",name:"Caudate Nucleus",file:"Brain-basal_ganglia-caudate_nucleus.json",parent:null,color:"#fb923c",opacity:.7,category:"limbic"},{id:"putamen",name:"Putamen",file:"Brain-basal_ganglia-putamen.json",parent:null,color:"#f97316",opacity:.65,category:"limbic"},{id:"globus-pallidus",name:"Globus Pallidus",file:"Brain-basal_ganglia-globus_pallidus.json",parent:null,color:"#ea580c",opacity:.65,category:"limbic"},{id:"nucleus-accumbens",name:"Nucleus Accumbens",file:"Brain-basal_ganglia-nucleus_accumbens.json",parent:null,color:"#c2410c",opacity:.7,category:"limbic"},{id:"substantia-nigra",name:"Substantia Nigra",file:"Brain-basal_ganglia-substantia_nigra.json",parent:null,color:"#9a3412",opacity:.7,category:"brainstem"},{id:"subthalamic-nucleus",name:"Subthalamic Nucleus",file:"Brain-basal_ganglia-subthalamic_nucleus.json",parent:null,color:"#7c2d12",opacity:.7,category:"limbic"},{id:"cn-i",name:"CN I — Olfactory",file:"Brain-cranial_nerves-cranial_nerve_I_olfactory.json",parent:null,color:"#a3e635",opacity:.6,category:"peripheral"},{id:"cn-ii",name:"CN II — Optic",file:"Brain-cranial_nerves-cranial_nerve_II_optic.json",parent:null,color:"#60a5fa",opacity:.6,category:"peripheral"},{id:"cn-iii",name:"CN III — Oculomotor",file:"Brain-cranial_nerves-cranial_nerve_III_oculomotor.json",parent:null,color:"#f97316",opacity:.55,category:"peripheral"},{id:"cn-iv",name:"CN IV — Trochlear",file:"Brain-cranial_nerves-cranial_nerve_IV_trochlear.json",parent:null,color:"#f97316",opacity:.55,category:"peripheral"},{id:"cn-v",name:"CN V — Trigeminal",file:"Brain-cranial_nerves-cranial_nerve_V_trigeminal.json",parent:null,color:"#e879f9",opacity:.6,category:"peripheral"},{id:"cn-vi",name:"CN VI — Abducens",file:"Brain-cranial_nerves-cranial_nerve_VI_abducens.json",parent:null,color:"#f97316",opacity:.55,category:"peripheral"},{id:"cn-vii",name:"CN VII — Facial",file:"Brain-cranial_nerves-cranial_nerve_VII_facial.json",parent:null,color:"#fbbf24",opacity:.6,category:"peripheral"},{id:"cn-viii",name:"CN VIII — Vestibulocochlear",file:"Brain-cranial_nerves-cranial_nerve_VIII_vestibulocochlear.json",parent:null,color:"#2dd4bf",opacity:.6,category:"peripheral"},{id:"cn-ix",name:"CN IX — Glossopharyngeal",file:"Brain-cranial_nerves-cranial_nerve_IX_glossopharyngeal.json",parent:null,color:"#fb923c",opacity:.55,category:"peripheral"},{id:"cn-x",name:"CN X — Vagus",file:"Brain-cranial_nerves-cranial_nerve_X_vagus.json",parent:null,color:"#22c55e",opacity:.65,category:"peripheral"},{id:"cn-xi",name:"CN XI — Accessory",file:"Brain-cranial_nerves-cranial_nerve_XI_accessory.json",parent:null,color:"#f87171",opacity:.55,category:"peripheral"},{id:"cn-xii",name:"CN XII — Hypoglossal",file:"Brain-cranial_nerves-cranial_nerve_XII_hypoglossal.json",parent:null,color:"#c084fc",opacity:.55,category:"peripheral"}],s={hemispheres:["left-hemisphere","right-hemisphere","corpus-callosum","auditory-cortex","olfactory-bulb"],cerebellum:["cerebellum"],brainstem:["midbrain","pons","medulla","substantia-nigra"],limbic:["hippocampus","amygdala","hypothalamus","entorhinal-cortex","dentate-gyrus","subiculum","thalamus"],deepStructures:["ventricles","pituitary"],basalGanglia:["caudate-nucleus","putamen","globus-pallidus","nucleus-accumbens","subthalamic-nucleus"],cranialNerves:["cn-i","cn-ii","cn-iii","cn-iv","cn-v","cn-vi","cn-vii","cn-viii","cn-ix","cn-x","cn-xi","cn-xii"]}},8327:(e,n,t)=>{t.r(n),t.d(n,{default:()=>en,renderOptionsRef:()=>$});var a=t(5155),r=t(2115),l=t(264),s=t(258),i=t(2912),o=t(6750),c=t(4492),u=t(6497),d=t(1138);let p={system_root:"left-hemisphere",cognitive_modules:"left-hemisphere",action_dispatch:"left-hemisphere",language_output:"left-hemisphere",language_comprehension:"left-hemisphere",sensory_encoders:"right-hemisphere",temporal_processing:"left-hemisphere",visual_processing:"right-hemisphere",narrative_engine:"left-hemisphere",attention_router:"thalamus",working_memory:"left-hemisphere",error_correction:"cerebellum",movement_planning:"cerebellum",execution_monitor:"cerebellum",balance_system:"cerebellum",correction_output:"cerebellum",inhibitory_gate:"cerebellum",background_processes:"midbrain",reflex_engine:"midbrain",dopamine_regulation:"substantia-nigra",motivation_signals:"substantia-nigra",relay_processors:"pons",alertness_state:"pons",mood_regulation:"pons",vital_controllers:"medulla",cardiac_oscillator:"medulla",respiratory_oscillator:"medulla",pressure_regulation:"medulla",visceral_input:"medulla",memory_embeddings:"hippocampus",memory_consolidation:"hippocampus",pattern_completion:"hippocampus",pattern_separation:"dentate-gyrus",state_modulators:"amygdala",action_selector:"caudate-nucleus",reward_signals:"nucleus-accumbens",signal_router:"thalamus",homeostasis_controller:"hypothalamus",circadian_clock:"hypothalamus",conflict_monitor:"caudate-nucleus",hemisphere_bridge:"corpus-callosum",body_state_monitor:"hypothalamus",autonomic_engine:"medulla",activation_signals:"midbrain",restoration_signals:"pons",global_state_modifier:"cn-x",gut_processor:"cn-x",oscillation_generator:"medulla",input_pipelines:"thalamus",output_pipelines:"left-hemisphere",fast_response_loops:"midbrain",integration_buses:"corpus-callosum",processing_units:"left-hemisphere",excitatory_nodes:"left-hemisphere",inhibitory_nodes:"globus-pallidus",support_infrastructure:"ventricles",connection_interfaces:"corpus-callosum",signal_molecules:"hypothalamus",reward_signal:"nucleus-accumbens",mood_baseline:"pons"},m={};for(let[e,n]of Object.entries(p))m[n]||(m[n]=[]),m[n].push(e);let x={"input-classifier":"thalamus","pattern-separator":"dentate-gyrus","emotional-tagger":"amygdala","memory-writer":"hippocampus","memory-retriever":"hippocampus","action-gate":"caudate-nucleus","reward-predictor":"nucleus-accumbens","error-corrector":"cerebellum","sensory-integrator":"corpus-callosum","action-dispatcher":"left-hemisphere","executive-controller":"left-hemisphere","narrative-engine":"left-hemisphere"},h={"input-raw":"thalamus","classify-result":"thalamus","memory-write":"hippocampus","memory-retrieve":"hippocampus","action-evaluate":"caudate-nucleus","action-execute":"left-hemisphere","reward-compute":"nucleus-accumbens",reflection:"left-hemisphere",thought:"left-hemisphere"};function f(e){var n;return null!=(n=p[e])?n:null}function v(e){var n;return null!=(n=x[e])?n:null}function y(e){var n;return null!=(n=h[e])?n:null}function g(e){var n;return null!=(n=m[e])?n:[]}let b=(0,d.v)((e,n)=>({connected:!1,connectionError:null,eventsPerSecond:0,recentEvents:[],maxRecentEvents:200,regionActivity:new Map,activeWorkers:new Map,queueStatus:new Map,emotionalState:null,systemVitals:null,lastThoughtTick:null,thoughtLoopPulse:0,selectedRegionId:null,hoveredRegionId:null,setConnected:function(n){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e({connected:n,connectionError:t})},setEventsPerSecond:n=>e({eventsPerSecond:n}),processEvent:t=>{let a=n(),r=t.event,l=Date.now(),s={recentEvents:[...a.recentEvents,t].slice(-a.maxRecentEvents)},i=new Map(a.regionActivity),o=new Map(a.activeWorkers),c=new Map(a.queueStatus);switch(r.type){case"thought_loop_tick":s.lastThoughtTick=r,s.thoughtLoopPulse=1;break;case"collection_activity":{let e=f(r.collection);e&&j(i,e,l,r.collection);break}case"worker_activity":{let e=v(r.worker);"started"===r.status?(o.set(r.job_id,{worker:r.worker,jobId:r.job_id,startedAt:l,regionId:e}),e&&j(i,e,l,r.worker)):o.delete(r.job_id),s.activeWorkers=o;break}case"queue_metrics":{c.set(r.queue,{queue:r.queue,pending:r.pending,active:r.active,completed:r.completed,failed:r.failed}),s.queueStatus=c;let e=y(r.queue);e&&r.active>0&&j(i,e,l,r.queue);break}case"emotional_state":s.emotionalState=r;break;case"system_vitals":s.systemVitals=r;break;case"soul_cycle":j(i,"left-hemisphere",l,"soul_cycle");break;case"action_dispatch":j(i,"left-hemisphere",l,"action_dispatch");break;case"memory_event":j(i,"hippocampus",l,"memory");break;case"reward_signal":j(i,"nucleus-accumbens",l,"reward");break;case"error_correction":j(i,"cerebellum",l,"error_correction")}s.regionActivity=i,e(s)},processHistory:e=>{for(let t of e)n().processEvent(t)},selectRegion:n=>e({selectedRegionId:n}),hoverRegion:n=>e({hoveredRegionId:n}),decayActivity:()=>{let t=n(),a=new Map,r=Date.now();for(let[e,n]of t.regionActivity){let t=Math.pow(.92,(r-n.lastActivity)/100),l=n.intensity*t;l>.05&&a.set(e,{...n,intensity:l})}let l=.95*t.thoughtLoopPulse;e({regionActivity:a,thoughtLoopPulse:l<.01?0:l})},triggerThoughtPulse:()=>e({thoughtLoopPulse:1})}));function j(e,n,t,a){var r;let l=e.get(n),s=l?Math.min(l.intensity+.3,1):.5,i=null!=(r=null==l?void 0:l.activeOperations)?r:new Set;i.add(a),e.set(n,{regionId:n,intensity:s,lastActivity:t,activeOperations:i})}var w=t(2587),_=t(5339),N=t(6923),k=t(3646);let S=(0,t(623).b)({time:0,fresnelAmount:.65,fresnelOpacity:1,outerColor:new _.Q1f(8930508),innerColor:new _.Q1f(2271999),accentColor:new _.Q1f(0xcc44aa),hologramBrightness:.8,hologramOpacity:1,noiseScale:.8,layerDepth:0,textureType:0},"\n    varying vec3 vNormal;\n    varying vec3 vViewPosition;\n    varying vec2 vUv;\n    varying vec3 vPositionW;\n    varying vec3 vNormalW;\n    varying vec3 vLocalPos;\n    varying vec4 vPos;\n\n    void main() {\n      vUv = uv;\n      vNormal = normalize(normalMatrix * normal);\n      vLocalPos = position;\n      \n      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n      vViewPosition = -mvPosition.xyz;\n      vPositionW = (modelMatrix * vec4(position, 1.0)).xyz;\n      vNormalW = normalize((modelMatrix * vec4(normal, 0.0)).xyz);\n      vPos = projectionMatrix * mvPosition;\n      \n      gl_Position = vPos;\n    }\n  ","\n    uniform float time;\n    uniform float fresnelAmount;\n    uniform float fresnelOpacity;\n    uniform vec3 outerColor;\n    uniform vec3 innerColor;\n    uniform vec3 accentColor;\n    uniform float hologramBrightness;\n    uniform float hologramOpacity;\n    uniform float noiseScale;\n    uniform float layerDepth;\n    uniform float textureType;\n    \n    varying vec3 vNormal;\n    varying vec3 vViewPosition;\n    varying vec2 vUv;\n    varying vec3 vPositionW;\n    varying vec3 vNormalW;\n    varying vec3 vLocalPos;\n    varying vec4 vPos;\n    \n    // Simplex-style noise for organic variation\n    vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n    vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n    vec4 permute(vec4 x) { return mod289(((x * 34.0) + 1.0) * x); }\n    vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }\n\n    float snoise(vec3 v) {\n      const vec2 C = vec2(1.0 / 6.0, 1.0 / 3.0);\n      const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\n      vec3 i = floor(v + dot(v, C.yyy));\n      vec3 x0 = v - i + dot(i, C.xxx);\n\n      vec3 g = step(x0.yzx, x0.xyz);\n      vec3 l = 1.0 - g;\n      vec3 i1 = min(g.xyz, l.zxy);\n      vec3 i2 = max(g.xyz, l.zxy);\n\n      vec3 x1 = x0 - i1 + C.xxx;\n      vec3 x2 = x0 - i2 + C.yyy;\n      vec3 x3 = x0 - D.yyy;\n\n      i = mod289(i);\n      vec4 p = permute(permute(permute(\n                i.z + vec4(0.0, i1.z, i2.z, 1.0))\n              + i.y + vec4(0.0, i1.y, i2.y, 1.0))\n              + i.x + vec4(0.0, i1.x, i2.x, 1.0));\n\n      float n_ = 0.142857142857;\n      vec3 ns = n_ * D.wyz - D.xzx;\n\n      vec4 j = p - 49.0 * floor(p * ns.z * ns.z);\n\n      vec4 x_ = floor(j * ns.z);\n      vec4 y_ = floor(j - 7.0 * x_);\n\n      vec4 x = x_ * ns.x + ns.yyyy;\n      vec4 y = y_ * ns.x + ns.yyyy;\n      vec4 h = 1.0 - abs(x) - abs(y);\n\n      vec4 b0 = vec4(x.xy, y.xy);\n      vec4 b1 = vec4(x.zw, y.zw);\n\n      vec4 s0 = floor(b0) * 2.0 + 1.0;\n      vec4 s1 = floor(b1) * 2.0 + 1.0;\n      vec4 sh = -step(h, vec4(0.0));\n\n      vec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy;\n      vec4 a1 = b1.xzyw + s1.xzyw * sh.zzww;\n\n      vec3 p0 = vec3(a0.xy, h.x);\n      vec3 p1 = vec3(a0.zw, h.y);\n      vec3 p2 = vec3(a1.xy, h.z);\n      vec3 p3 = vec3(a1.zw, h.w);\n\n      vec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\n      p0 *= norm.x; p1 *= norm.y; p2 *= norm.z; p3 *= norm.w;\n\n      vec4 m = max(0.6 - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0);\n      m = m * m;\n      return 42.0 * dot(m * m, vec4(dot(p0, x0), dot(p1, x1), dot(p2, x2), dot(p3, x3)));\n    }\n\n    void main() {\n      // Fresnel - bright at edges, transparent in center\n      vec3 viewDir = normalize(cameraPosition - vPositionW);\n      float fresnelBase = dot(viewDir, vNormalW);\n      float fresnel = clamp(fresnelAmount - fresnelBase * (1.6 - fresnelOpacity / 2.0), 0.0, fresnelOpacity);\n      \n      float t = time * 0.15;\n      float noise = 0.5;\n      float veinIntensity = 0.0;\n      int tType = int(textureType + 0.5);\n      \n      if (tType == 1) {\n        // CEREBELLUM: tight, regular, parallel ridge folds\n        float ridges = sin(vLocalPos.y * noiseScale * 12.0 + snoise(vLocalPos * noiseScale * 2.0) * 2.0 + t);\n        ridges = clamp(ridges, 0.0, 1.0);\n        ridges = ridges * ridges;\n        noise = snoise(vLocalPos * noiseScale * 2.5 + t * 0.5) * 0.5 + 0.5;\n        veinIntensity = clamp(ridges * 0.7, 0.0, 1.0);\n        \n      } else if (tType == 2) {\n        // BRAINSTEM: vertical fiber bundles, directional streaks\n        float fibers = sin(vLocalPos.y * noiseScale * 8.0 + t * 0.3) * 0.5 + 0.5;\n        float fiberNoise = snoise(vec3(vLocalPos.x * noiseScale * 3.0, vLocalPos.y * noiseScale * 0.5, vLocalPos.z * noiseScale * 3.0) + t * 0.4);\n        fibers *= clamp(fiberNoise + 0.6, 0.0, 1.0);\n        noise = fibers;\n        veinIntensity = clamp(fibers * fibers * 0.6, 0.0, 1.0);\n        \n      } else if (tType == 3) {\n        // LIMBIC: turbulent, clustered, organic nuclei\n        float turb = snoise(vLocalPos * noiseScale * 1.8 + t * 0.8) * 0.5 + 0.5;\n        float cluster = snoise(vLocalPos * noiseScale * 3.0 + 10.0 + t * 0.3) * 0.5 + 0.5;\n        turb = turb * cluster;\n        noise = turb;\n        float veins = clamp(1.0 - abs(snoise(vLocalPos * noiseScale * 2.5 + t * 0.5)), 0.0, 1.0);\n        veinIntensity = clamp(veins * veins * 0.5 + turb * 0.3, 0.0, 1.0);\n        \n      } else if (tType == 4) {\n        // WHITE MATTER (corpus callosum): smooth parallel flowing fibers\n        float flow = snoise(vec3(vLocalPos.x * noiseScale * 0.4, vLocalPos.y * noiseScale * 3.0, vLocalPos.z * noiseScale * 0.4) + t * 0.5);\n        flow = flow * 0.5 + 0.5;\n        noise = flow;\n        float strands = sin(vLocalPos.x * noiseScale * 6.0 + flow * 4.0 + t) * 0.5 + 0.5;\n        veinIntensity = clamp(strands * flow * 0.6, 0.0, 1.0);\n        \n      } else if (tType == 5) {\n        // PERIPHERAL (cranial nerves): elongated linear fibers\n        float stretch = snoise(vec3(vLocalPos.x * noiseScale * 0.5, vLocalPos.y * noiseScale * 5.0, vLocalPos.z * noiseScale * 0.5) + t * 0.6);\n        stretch = stretch * 0.5 + 0.5;\n        noise = stretch;\n        veinIntensity = clamp(stretch * stretch * 0.5, 0.0, 1.0);\n        \n      } else if (tType == 6) {\n        // FLUID (ventricles): very smooth, slow, liquid-like\n        noise = snoise(vLocalPos * noiseScale * 0.3 + t * 0.2) * 0.5 + 0.5;\n        veinIntensity = clamp(noise * noise * 0.2, 0.0, 1.0);\n        \n      } else {\n        // CORTEX (default): broad undulating folds, layered\n        noise = snoise(vLocalPos * noiseScale + t) * 0.5 + 0.5;\n        float veins = abs(snoise(vLocalPos * noiseScale * 1.5 + t * 0.7));\n        veins = clamp(1.0 - veins, 0.0, 1.0);\n        veinIntensity = clamp(veins * veins * veins, 0.0, 1.0);\n      }\n      \n      // Color gradient: purple at edges -> cyan at center/veins\n      // Outer layers are more purple, inner layers more cyan\n      float colorMix = fresnel * 0.6 + (1.0 - layerDepth) * 0.4;\n      vec3 surfaceColor = mix(innerColor, outerColor, colorMix);\n      \n      // Veins glow brighter cyan/white\n      vec3 veinColor = mix(innerColor, vec3(0.7, 0.85, 1.0), 0.4);\n      \n      // Accent color mixed in via noise for variation\n      vec3 accentMix = accentColor * noise * 0.2 * (1.0 - layerDepth);\n      \n      // Inner glow\n      float innerGlow = (1.0 - fresnel) * noise * 0.2 * (0.3 + layerDepth * 0.7);\n      \n      // Compose final color - noise is a subtle undertone, not dominant\n      vec3 finalColor = surfaceColor * hologramBrightness * (fresnel * 0.8 + innerGlow);\n      finalColor += veinColor * veinIntensity * 0.25 * hologramBrightness;\n      finalColor += accentMix * 0.6;\n      \n      // Subtle vein brightening\n      finalColor += vec3(0.8, 0.9, 1.0) * veinIntensity * veinIntensity * 0.08;\n      finalColor = clamp(finalColor, 0.0, 2.0);\n      \n      // Opacity: strong fresnel edges for wireframe look, veins subtle\n      float fillAmount = mix(0.0, 0.04, layerDepth);\n      float fresnelAlpha = fresnel * mix(0.55, 0.65, layerDepth);\n      float veinAlpha = veinIntensity * mix(0.15, 0.12, layerDepth);\n      float alpha = fillAmount + fresnelAlpha + veinAlpha + innerGlow;\n      alpha *= hologramOpacity;\n      alpha = clamp(alpha, 0.0, 1.0);\n      \n      gl_FragColor = vec4(finalColor, alpha);\n    }\n  ");(0,l.e)({NeuralBrainShaderMaterial:S});let C={transparent:!0,side:_.$EB,depthWrite:!1,blending:_.EZo},P=new Map,I=new Set,B=(0,r.createContext)({visibleIds:new Set(w.Px.map(e=>e.id))});function M(e){let{visibleIds:n,children:t}=e;return(0,a.jsx)(B.Provider,{value:{visibleIds:n},children:t})}let T=new Set(["left-hemisphere","right-hemisphere","cerebellum","corpus-callosum"]),z=new Set(["midbrain","pons","medulla","thalamus","auditory-cortex"]);function A(e){var n,t;let s,i,o,{entry:c}=e,u=function(e){var n;let[t,a]=(0,r.useState)(null!=(n=P.get(e))?n:null);return(0,r.useEffect)(()=>{if(P.has(e))return void a(P.get(e));I.has(e)||(I.add(e),fetch("/models/brain/".concat(e)).then(e=>e.json()).then(n=>{let t=(0,w.DR)(n);P.set(e,t),a(t)}).catch(()=>I.delete(e)))},[e]),t}(c.file),d=(0,r.useRef)(null),p=(0,r.useRef)(!1),[,m]=(0,r.useState)(0),{selectedRegionId:x,selectRegion:h,hoverRegion:f,regionActivity:v}=b(),y=x===c.id,j=v.get(c.id),N=null!=(n=null==j?void 0:j.intensity)?n:0,k=g(c.id),S=(t=c.id,T.has(t)?0:z.has(t)?.5:1),B=(0,r.useMemo)(()=>{let e=c.id,n=c.category;if("corpus-callosum"===e)return{outer:new _.Q1f(4482747),inner:new _.Q1f(5623039),accent:new _.Q1f(6715340),noiseScale:.8,textureType:4};if("ventricles"===e)return{outer:new _.Q1f(3364283),inner:new _.Q1f(3390463),accent:new _.Q1f(5601228),noiseScale:.5,textureType:6};if(["caudate-nucleus","putamen","globus-pallidus","nucleus-accumbens","subthalamic-nucleus"].includes(e))return{outer:new _.Q1f(7816362),inner:new _.Q1f(0xbb77dd),accent:new _.Q1f(0x9955bb),noiseScale:1,textureType:3};switch(n){case"cerebrum":return{outer:new _.Q1f(5588138),inner:new _.Q1f(2276351),accent:new _.Q1f(7816379),noiseScale:.7,textureType:0};case"cerebellum":return{outer:new _.Q1f(4478395),inner:new _.Q1f(2280703),accent:new _.Q1f(6706636),noiseScale:.6,textureType:1};case"brainstem":return{outer:new _.Q1f(6702250),inner:new _.Q1f(4500206),accent:new _.Q1f(0x9944aa),noiseScale:.8,textureType:2};case"limbic":return{outer:new _.Q1f(5592507),inner:new _.Q1f(3394781),accent:new _.Q1f(8934826),noiseScale:.9,textureType:3};case"endocrine":return{outer:new _.Q1f(4482730),inner:new _.Q1f(4513228),accent:new _.Q1f(6719675),noiseScale:1,textureType:3};case"peripheral":return{outer:new _.Q1f(2258858),inner:new _.Q1f(2289339),accent:new _.Q1f(3385992),noiseScale:.8,textureType:5};default:return{outer:new _.Q1f(5588138),inner:new _.Q1f(2276351),accent:new _.Q1f(7816379),noiseScale:.8,textureType:0}}},[c.id,c.category]),M=T.has(c.id),A=(0,r.useMemo)(()=>{let e=new _.V9B({color:B.inner,wireframe:!0,transparent:!0,opacity:M?.05:.08,depthWrite:!1});return e.blending=_.EZo,e},[M,B.inner]),L="left-hemisphere"===c.id,D="right-hemisphere"===c.id;if(L?(s=.58,i=.25,o=.2):D?(s=.7,i=.6,o=.5):0===S?(s=.6,i=.45,o=.35):.5===S?(s=.5,i=.4,o=.5):(s=.45,i=.5,o=.55),(0,l.D)(e=>{let{clock:n}=e;if(!d.current)return;let t=p.current;d.current.uniforms.time.value=n.getElapsedTime();let a=i,r=o,l=s;t&&(a+=.3,r=Math.min(r+.15,1),l=Math.min(l+.1,.95)),y&&(a+=.4,r=Math.min(r+.2,1),l=Math.min(l+.15,.95)),N>0&&(a+=.4*N);let c=d.current.uniforms;c.hologramBrightness.value=_.cj9.lerp(c.hologramBrightness.value,a,.1),c.hologramOpacity.value=_.cj9.lerp(c.hologramOpacity.value,r,.1),c.fresnelAmount.value=_.cj9.lerp(c.fresnelAmount.value,l,.1),c.noiseScale.value=B.noiseScale,c.textureType.value=B.textureType,c.outerColor.value.copy(B.outer),c.innerColor.value.copy(B.inner),c.accentColor.value.copy(B.accent),c.layerDepth.value=S}),!u)return null;let Q=p.current||y||N>.3,{showShader:R,showWireframe:O}=$;return(0,a.jsxs)("group",{children:[(0,a.jsx)("mesh",{geometry:u,visible:!1,onClick:e=>{e.stopPropagation(),h(y?null:c.id)},onPointerOver:e=>{e.stopPropagation(),p.current=!0,f(c.id),document.body.style.cursor="pointer",m(e=>e+1)},onPointerOut:()=>{p.current=!1,f(null),document.body.style.cursor="",m(e=>e+1)},children:(0,a.jsx)("meshBasicMaterial",{transparent:!0,opacity:0,side:_.$EB})}),R&&(0,a.jsx)("mesh",{geometry:u,children:(0,a.jsx)("neuralBrainShaderMaterial",{ref:d,fresnelAmount:s,fresnelOpacity:1,outerColor:B.outer,innerColor:B.inner,accentColor:B.accent,hologramBrightness:i,hologramOpacity:o,noiseScale:B.noiseScale,textureType:B.textureType,layerDepth:S,...C})}),O&&(0,a.jsx)("mesh",{geometry:u,material:A}),Q&&u&&(0,a.jsx)(E,{entry:c,geometry:u,activityIntensity:N,collections:k,isSelected:y})]})}function E(e){let{entry:n,geometry:t,activityIntensity:l,collections:s,isSelected:i}=e,o=(0,r.useMemo)(()=>{t.computeBoundingBox();let e=t.boundingBox,n=new _.Pq0;return e.getCenter(n),n.y=e.max.y+.6,n},[t]);return(0,a.jsxs)("group",{position:[o.x,o.y,o.z],children:[(0,a.jsx)(N.E,{fontSize:.45,color:i?"#00ffff":"#88ddff",anchorX:"center",anchorY:"bottom",outlineWidth:.025,outlineColor:"#000000",children:n.name}),l>.1&&(0,a.jsx)(k.E,{center:!0,position:[0,.7,0],children:(0,a.jsxs)("div",{className:"bg-black/70 backdrop-blur-sm rounded-lg px-2.5 py-1.5 text-[10px] whitespace-nowrap border border-cyan-500/30 shadow-lg shadow-cyan-500/20",children:[(0,a.jsx)("span",{className:"text-cyan-400 font-medium",children:s.length>0?"".concat(s.length," collection").concat(s.length>1?"s":""):"Active"}),(0,a.jsxs)("span",{className:"text-cyan-600 ml-1.5",children:[Math.round(100*l),"%"]})]})})]})}function L(e){let{loaded:n,total:t}=e;return n>=t?null:(0,a.jsx)(k.E,{center:!0,position:[0,12,0],children:(0,a.jsx)("div",{className:"bg-black/60 backdrop-blur-xl rounded-xl px-5 py-3 text-xs text-cyan-400 whitespace-nowrap border border-cyan-500/20",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-cyan-500/30 border-t-cyan-400 rounded-full animate-spin"}),"Loading neural map... ",n,"/",t]})})})}function D(){let{visibleIds:e}=(0,r.useContext)(B),[n,t]=(0,r.useState)(0);(0,r.useEffect)(()=>{let e=setInterval(()=>t(P.size),200);return()=>clearInterval(e)},[]);let l=(0,r.useMemo)(()=>w.Px.filter(n=>e.has(n.id)),[e]);return(0,a.jsxs)("group",{children:[(0,a.jsx)(L,{loaded:n,total:l.length}),l.map(e=>(0,a.jsx)(A,{entry:e},e.id))]})}var Q=t(8381),R=t(3303);function O(){return(0,a.jsxs)(Q.s0,{multisampling:0,children:[(0,a.jsx)(Q.mK,{intensity:1.3,luminanceThreshold:.1,luminanceSmoothing:.9,mipmapBlur:!0,radius:.85}),(0,a.jsx)(Q.fE,{offset:.25,darkness:.65,blendFunction:R.cf.NORMAL})]})}function W(e){var n,t,r;let{panelOpen:l,onTogglePanel:s}=e,{connected:i,eventsPerSecond:o,emotionalState:u,lastThoughtTick:d}=b(),p=null!=(n=null==u?void 0:u.mood)?n:"Unknown",m=null!=(t=null==u?void 0:u.valence)?t:0;return(0,a.jsx)(c.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.2,duration:.4},className:"absolute top-4 left-1/2 -translate-x-1/2 z-30",children:(0,a.jsxs)("div",{className:"backdrop-blur-xl bg-black/40 border border-white/[0.06] rounded-2xl px-1.5 py-1.5 flex items-center gap-1",children:[(0,a.jsxs)("div",{className:"px-3 flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full transition-all duration-300",style:{backgroundColor:i?"#22c55e":"#ef4444",boxShadow:i?"0 0 8px #22c55e80":"0 0 8px #ef444480"}}),(0,a.jsx)("span",{className:"text-xs font-semibold text-neutral-300 tracking-wide",children:"LIVE VIEW"})]}),(0,a.jsx)("div",{className:"w-px h-5 bg-white/[0.06]"}),(0,a.jsxs)("div",{className:"px-3 flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("span",{className:"text-[10px] text-neutral-500 uppercase",children:"Events"}),(0,a.jsxs)("span",{className:"text-xs font-mono text-cyan-400",children:[o.toFixed(1),"/s"]})]}),d&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-px h-4 bg-white/[0.04]"}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("span",{className:"text-[10px] text-neutral-500 uppercase",children:"Mood"}),(0,a.jsx)("span",{className:"text-xs font-medium",style:{color:m>.3?"#22c55e":m<-.3?"#ef4444":"#f59e0b"},children:p})]}),(0,a.jsx)("div",{className:"w-px h-4 bg-white/[0.04]"}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("span",{className:"text-[10px] text-neutral-500 uppercase",children:"Energy"}),(0,a.jsxs)("span",{className:"text-xs font-mono text-purple-400",children:[((null!=(r=d.energy)?r:0)*100).toFixed(0),"%"]})]})]})]}),(0,a.jsx)("div",{className:"w-px h-5 bg-white/[0.06]"}),(0,a.jsx)("button",{onClick:s,className:"px-3 py-1.5 rounded-xl text-xs font-medium transition-all duration-200 ".concat(l?"bg-indigo-500/15 text-indigo-400 border border-indigo-500/20":"text-neutral-500 hover:text-neutral-300 hover:bg-white/[0.04]"),children:"Processes"})]})})}function V(e){return e<1e3?"".concat(e,"ms"):"".concat((e/1e3).toFixed(1),"s")}function q(e){var n;let{type:t}=e,{icon:r,color:l}=null!=(n=({thought_loop_tick:{icon:"◉",color:"#818cf8"},collection_activity:{icon:"◆",color:"#22c55e"},worker_activity:{icon:"⚙",color:"#f59e0b"},queue_metrics:{icon:"▤",color:"#06b6d4"},emotional_state:{icon:"♥",color:"#ec4899"},soul_cycle:{icon:"✧",color:"#a78bfa"},action_dispatch:{icon:"→",color:"#fb923c"},system_vitals:{icon:"♡",color:"#ef4444"},budget_status:{icon:"$",color:"#eab308"},memory_event:{icon:"◇",color:"#14b8a6"},reward_signal:{icon:"★",color:"#f472b6"},error_correction:{icon:"⟳",color:"#8b5cf6"}})[t])?n:{icon:"•",color:"#666"};return(0,a.jsx)("span",{className:"text-xs",style:{color:l},children:r})}function F(e){let{event:n}=e;switch(n.type){case"thought_loop_tick":return(0,a.jsxs)("span",{children:["Thought tick"," ",n.impulse&&(0,a.jsx)("span",{className:"text-indigo-400",children:"(impulse)"})]});case"collection_activity":return(0,a.jsxs)("span",{children:[(0,a.jsx)("span",{className:"text-cyan-400 font-mono",children:n.collection})," ",(0,a.jsx)("span",{className:"text-neutral-500",children:n.operation})," ",(0,a.jsxs)("span",{className:"text-neutral-400",children:["\xd7",n.count]})]});case"worker_activity":return(0,a.jsxs)("span",{children:[(0,a.jsx)("span",{className:"text-amber-400",children:n.worker})," ",(0,a.jsx)("span",{className:"completed"===n.status?"text-emerald-500":"failed"===n.status?"text-red-500":"text-neutral-500",children:n.status}),n.duration_ms&&(0,a.jsx)("span",{className:"text-neutral-600 ml-1",children:V(n.duration_ms)})]});case"queue_metrics":return(0,a.jsxs)("span",{children:[(0,a.jsx)("span",{className:"text-cyan-400 font-mono",children:n.queue})," ",(0,a.jsxs)("span",{className:"text-neutral-500",children:[n.pending,"p / ",n.active,"a"]})]});case"emotional_state":return(0,a.jsxs)("span",{children:["Mood:"," ",(0,a.jsx)("span",{className:n.valence>.3?"text-emerald-400":n.valence<-.3?"text-red-400":"text-amber-400",children:n.mood})]});case"soul_cycle":return(0,a.jsxs)("span",{children:["Soul cycle"," ",(0,a.jsx)("span",{className:"text-purple-400",children:n.tier})," ",(0,a.jsx)("span",{className:"text-neutral-500",children:n.status})]});case"action_dispatch":return(0,a.jsxs)("span",{children:["Action:"," ",(0,a.jsx)("span",{className:"text-orange-400",children:n.action})," ",(0,a.jsxs)("span",{className:"text-neutral-500",children:["→ ",n.target]})]});case"system_vitals":return(0,a.jsxs)("span",{children:["Vitals: CPU ",n.cpu_percent.toFixed(0),"% / Mem"," ",n.memory_percent.toFixed(0),"%"]});case"memory_event":return(0,a.jsxs)("span",{children:["Memory ",(0,a.jsx)("span",{className:"text-teal-400",children:n.operation})]});case"reward_signal":return(0,a.jsxs)("span",{children:["Reward:"," ",(0,a.jsxs)("span",{className:n.prediction_error>0?"text-emerald-400":"text-red-400",children:[n.prediction_error>0?"+":"",n.prediction_error.toFixed(2)]})]});case"error_correction":return(0,a.jsxs)("span",{children:["Error correction:"," ",(0,a.jsx)("span",{className:"text-purple-400",children:n.source})]});default:return(0,a.jsx)("span",{children:n.type})}}function G(){let{recentEvents:e,activeWorkers:n,selectedRegionId:t,selectRegion:l,regionActivity:s}=b(),i=t?w.Px.find(e=>e.id===t):null,o=(0,r.useMemo)(()=>e.filter(e=>{if(!t)return!0;let n=e.event;switch(n.type){case"collection_activity":return f(n.collection)===t;case"worker_activity":return v(n.worker)===t;case"queue_metrics":return y(n.queue)===t;default:return!0}}).slice(-50),[e,t]),u=(0,r.useMemo)(()=>Array.from(s.entries()).filter(e=>{let[,n]=e;return n.intensity>.1}).sort((e,n)=>n[1].intensity-e[1].intensity).slice(0,8),[s]),d=t?g(t):[];return(0,a.jsxs)(c.P.div,{initial:{opacity:0,x:40},animate:{opacity:1,x:0},exit:{opacity:0,x:40},transition:{type:"spring",stiffness:300,damping:30},className:"absolute top-20 right-4 bottom-20 z-20 w-[360px] max-w-[40vw] flex flex-col gap-3 overflow-hidden pointer-events-none",children:[i&&(0,a.jsxs)("div",{className:"pointer-events-auto backdrop-blur-xl bg-black/50 border border-white/[0.06] rounded-2xl overflow-hidden shrink-0",children:[(0,a.jsx)("div",{className:"h-1 w-full",style:{background:"linear-gradient(90deg, ".concat(i.color,", ").concat(i.color,"00)")}}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:i.color,boxShadow:"0 0 8px ".concat(i.color,"60")}}),(0,a.jsx)("span",{className:"text-sm font-semibold text-white",children:i.name})]}),(0,a.jsx)("button",{onClick:()=>l(null),className:"text-neutral-500 hover:text-neutral-300 transition-colors",children:(0,a.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,a.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),d.length>0&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsxs)("span",{className:"text-[10px] text-neutral-500 uppercase tracking-wider",children:["Collections (",d.length,")"]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-1 mt-1",children:[d.slice(0,6).map(e=>(0,a.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-cyan-500/10 text-cyan-400 border border-cyan-500/20 font-mono",children:e},e)),d.length>6&&(0,a.jsxs)("span",{className:"text-[10px] text-neutral-600",children:["+",d.length-6]})]})]})]})]}),n.size>0&&(0,a.jsxs)("div",{className:"pointer-events-auto backdrop-blur-xl bg-black/50 border border-white/[0.06] rounded-2xl p-4 shrink-0",children:[(0,a.jsxs)("span",{className:"text-[10px] text-neutral-500 uppercase tracking-widest font-semibold",children:["Active Workers (",n.size,")"]}),(0,a.jsx)("div",{className:"mt-2 space-y-1.5",children:Array.from(n.values()).slice(0,5).map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,a.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-amber-500 animate-pulse"}),(0,a.jsx)("span",{className:"text-amber-400",children:e.worker}),(0,a.jsx)("span",{className:"text-neutral-600 font-mono text-[10px] ml-auto",children:V(Date.now()-e.startedAt)})]},e.jobId))})]}),!t&&u.length>0&&(0,a.jsxs)("div",{className:"pointer-events-auto backdrop-blur-xl bg-black/50 border border-white/[0.06] rounded-2xl p-4 shrink-0",children:[(0,a.jsx)("span",{className:"text-[10px] text-neutral-500 uppercase tracking-widest font-semibold",children:"Active Regions"}),(0,a.jsx)("div",{className:"mt-2 space-y-1.5",children:u.map(e=>{let[n,t]=e,r=w.Px.find(e=>e.id===n);return r?(0,a.jsxs)("button",{onClick:()=>l(n),className:"w-full flex items-center gap-2 text-xs hover:bg-white/[0.02] rounded px-1 py-0.5 transition-colors",children:[(0,a.jsx)("span",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:r.color,boxShadow:"0 0 4px ".concat(r.color,"60")}}),(0,a.jsx)("span",{className:"text-neutral-300",children:r.name}),(0,a.jsx)("div",{className:"ml-auto flex items-center gap-1",children:(0,a.jsx)("div",{className:"w-12 h-1 bg-white/[0.06] rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full rounded-full transition-all duration-300",style:{width:"".concat(100*t.intensity,"%"),backgroundColor:r.color}})})})]},n):null})})]}),(0,a.jsxs)("div",{className:"pointer-events-auto backdrop-blur-xl bg-black/50 border border-white/[0.06] rounded-2xl flex-1 min-h-0 overflow-hidden flex flex-col",children:[(0,a.jsx)("div",{className:"p-3 border-b border-white/[0.04] shrink-0",children:(0,a.jsxs)("span",{className:"text-[10px] text-neutral-500 uppercase tracking-widest font-semibold",children:["Event Stream",t&&(0,a.jsx)("span",{className:"text-indigo-400 ml-1",children:"(filtered)"})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",style:{scrollbarWidth:"thin"},children:0===o.length?(0,a.jsx)("div",{className:"text-center py-8 text-neutral-600 text-xs",children:"Waiting for events..."}):o.map(e=>(0,a.jsxs)("div",{className:"flex items-start gap-2 px-2 py-1 rounded hover:bg-white/[0.02] transition-colors",children:[(0,a.jsx)(q,{type:e.event.type}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsx)("div",{className:"text-[11px] text-neutral-300 truncate",children:(0,a.jsx)(F,{event:e.event})})}),(0,a.jsx)("span",{className:"text-[9px] text-neutral-600 font-mono shrink-0",children:new Date(e.received_at).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})})]},e.id))})]})]})}function X(e){let{values:n,max:t,color:r,label:l}=e,s=n.map(e=>Math.min(e/t,1));return(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-[9px] text-neutral-600 uppercase tracking-wider",children:l}),(0,a.jsx)("div",{className:"flex items-end gap-px h-6",children:s.map((e,n)=>(0,a.jsx)("div",{className:"w-1 rounded-t transition-all duration-200",style:{height:"".concat(Math.max(100*e,4),"%"),backgroundColor:e>.7?"#ef4444":r,opacity:.3+.7*e}},n))})]})}function H(e){let{value:n,max:t,label:r,color:l,unit:s=""}=e,i=Math.min(n/t*100,100);return(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-[9px] text-neutral-600 uppercase tracking-wider",children:r}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-16 h-1.5 bg-white/[0.06] rounded-full overflow-hidden",children:(0,a.jsx)(c.P.div,{className:"h-full rounded-full",style:{backgroundColor:l},initial:{width:0},animate:{width:"".concat(i,"%")},transition:{duration:.3}})}),(0,a.jsxs)("span",{className:"text-[10px] font-mono",style:{color:l},children:[n.toFixed(0),s]})]})]})}function U(){var e,n;let{queueStatus:t,systemVitals:l,emotionalState:s,connected:i,recentEvents:o}=b(),u=(0,r.useMemo)(()=>{let e=[];for(let n of t.values())e.push(n.pending+n.active);for(;e.length<10;)e.push(0);return e.slice(-10)},[t]),d=(0,r.useMemo)(()=>{let e=0;for(let n of t.values())e+=n.pending+n.active;return e},[t]),p=(0,r.useMemo)(()=>{let e=Date.now(),n=Array(10).fill(0);for(let t of o.slice(-100)){let a=Math.floor((e-new Date(t.received_at).getTime())/1e3);a>=0&&a<10&&n[9-a]++}return n},[o]),m=null!=(e=null==s?void 0:s.valence)?e:0,x=null!=(n=null==s?void 0:s.arousal)?n:.5;return(0,a.jsx)(c.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.4},className:"absolute bottom-4 left-4 right-4 z-20",children:(0,a.jsx)("div",{className:"backdrop-blur-xl bg-black/40 border border-white/[0.06] rounded-2xl px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full transition-all duration-300",style:{backgroundColor:i?"#22c55e":"#ef4444",boxShadow:i?"0 0 6px #22c55e60":"0 0 6px #ef444460"}}),(0,a.jsx)("span",{className:"text-[10px] text-neutral-500 uppercase tracking-wider",children:i?"Connected":"Disconnected"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsx)(X,{values:p,max:20,color:"#6366f1",label:"Events"}),(0,a.jsx)(X,{values:u,max:50,color:"#06b6d4",label:"Queues"}),(0,a.jsx)("div",{className:"w-px h-8 bg-white/[0.06]"}),l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(H,{value:l.cpu_percent,max:100,label:"CPU",color:l.cpu_percent>80?"#ef4444":"#22c55e",unit:"%"}),(0,a.jsx)(H,{value:l.memory_percent,max:100,label:"Memory",color:l.memory_percent>80?"#ef4444":"#06b6d4",unit:"%"})]}),(0,a.jsx)("div",{className:"w-px h-8 bg-white/[0.06]"}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-[9px] text-neutral-600 uppercase tracking-wider",children:"Valence"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"w-16 h-1.5 bg-white/[0.06] rounded-full overflow-hidden relative",children:[(0,a.jsxs)("div",{className:"absolute inset-0 flex",children:[(0,a.jsx)("div",{className:"w-1/2 bg-gradient-to-r from-red-500/20 to-transparent"}),(0,a.jsx)("div",{className:"w-1/2 bg-gradient-to-l from-emerald-500/20 to-transparent"})]}),(0,a.jsx)(c.P.div,{className:"absolute top-0 bottom-0 w-1 rounded-full bg-white",style:{left:"".concat((m+1)*50,"%")},animate:{left:"".concat((m+1)*50,"%")},transition:{duration:.3}})]}),(0,a.jsxs)("span",{className:"text-[10px] font-mono",style:{color:m>.3?"#22c55e":m<-.3?"#ef4444":"#f59e0b"},children:[m>0?"+":"",m.toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-[9px] text-neutral-600 uppercase tracking-wider",children:"Arousal"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-16 h-1.5 bg-white/[0.06] rounded-full overflow-hidden",children:(0,a.jsx)(c.P.div,{className:"h-full rounded-full bg-purple-500",animate:{width:"".concat(100*x,"%")},transition:{duration:.3}})}),(0,a.jsxs)("span",{className:"text-[10px] font-mono text-purple-400",children:[(100*x).toFixed(0),"%"]})]})]}),(0,a.jsx)("div",{className:"w-px h-8 bg-white/[0.06]"}),(0,a.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,a.jsx)("span",{className:"text-[9px] text-neutral-600 uppercase tracking-wider",children:"Queue Total"}),(0,a.jsx)("span",{className:"text-sm font-mono text-cyan-400",children:d})]})]})]})})})}let J={current:.08},$={showShader:!0,showWireframe:!1};function Y(){let e=(0,r.useRef)(null);return(0,l.D)((n,t)=>{e.current&&(e.current.rotation.y+=t*J.current)}),(0,a.jsx)("group",{ref:e,children:(0,a.jsx)(D,{})})}let Z=[{key:"hemispheres",label:"Cortex",color:"#6366f1"},{key:"cerebellum",label:"Cerebellum",color:"#8b5cf6"},{key:"brainstem",label:"Brainstem",color:"#ec4899"},{key:"limbic",label:"Limbic",color:"#f97316"},{key:"deepStructures",label:"Deep",color:"#38bdf8"},{key:"basalGanglia",label:"Basal Ganglia",color:"#fb923c"},{key:"cranialNerves",label:"Nerves",color:"#22c55e"}];function K(e){let{activeLayers:n,onToggle:t,onShowAll:l}=e,[s,i]=(0,r.useState)(.08),[o,u]=(0,r.useState)(!0),[d,p]=(0,r.useState)(!1);return(0,a.jsx)(c.P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3,duration:.4},className:"absolute top-20 left-4 z-20 flex flex-col gap-1.5",children:(0,a.jsxs)("div",{className:"backdrop-blur-xl bg-black/40 border border-white/6 rounded-xl p-2 flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-[10px] text-neutral-500 uppercase tracking-widest font-semibold px-1 mb-0.5",children:"Layers"}),Z.map(e=>{let{key:r,label:l,color:s}=e,i=n.has(r);return(0,a.jsxs)("button",{onClick:()=>t(r),className:"flex items-center gap-2 px-2.5 py-1.5 rounded-lg text-xs font-medium transition-all duration-200",style:{background:i?"".concat(s,"15"):"transparent",color:i?s:"#525252"},children:[(0,a.jsx)("span",{className:"w-2 h-2 rounded-full transition-all duration-200",style:{backgroundColor:i?s:"#333",boxShadow:i?"0 0 6px ".concat(s,"60"):"none"}}),l]},r)}),(0,a.jsx)("div",{className:"h-px bg-white/4 my-1"}),(0,a.jsx)("button",{onClick:l,className:"text-[10px] text-neutral-500 hover:text-neutral-300 px-2 py-1 transition-colors",children:"Show All"}),(0,a.jsx)("div",{className:"h-px bg-white/4 my-1"}),(0,a.jsxs)("div",{className:"px-1 flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-[10px] text-neutral-500 uppercase tracking-widest font-semibold",children:"Spin"}),(0,a.jsx)("input",{type:"range",min:"0",max:"0.5",step:"0.01",value:s,onChange:e=>{let n=parseFloat(e.target.value);i(n),J.current=n},className:"w-full h-1 appearance-none bg-neutral-700 rounded-full cursor-pointer accent-cyan-500"})]}),(0,a.jsx)("div",{className:"h-px bg-white/4 my-1"}),(0,a.jsx)("span",{className:"text-[10px] text-neutral-500 uppercase tracking-widest font-semibold px-1 mb-0.5",children:"Render"}),(0,a.jsxs)("button",{onClick:()=>{let e=!o;u(e),$.showShader=e},className:"flex items-center gap-2 px-2.5 py-1.5 rounded-lg text-xs font-medium transition-all duration-200",style:{background:o?"#6366f115":"transparent",color:o?"#818cf8":"#525252"},children:[(0,a.jsx)("span",{className:"w-2 h-2 rounded-full transition-all duration-200",style:{backgroundColor:o?"#818cf8":"#333",boxShadow:o?"0 0 6px #818cf860":"none"}}),"Shader"]}),(0,a.jsxs)("button",{onClick:()=>{let e=!d;p(e),$.showWireframe=e},className:"flex items-center gap-2 px-2.5 py-1.5 rounded-lg text-xs font-medium transition-all duration-200",style:{background:d?"#22d3ee15":"transparent",color:d?"#22d3ee":"#525252"},children:[(0,a.jsx)("span",{className:"w-2 h-2 rounded-full transition-all duration-200",style:{backgroundColor:d?"#22d3ee":"#333",boxShadow:d?"0 0 6px #22d3ee60":"none"}}),"Wireframe"]})]})})}function ee(){let{connected:e,connectionError:n}=b();return e?null:(0,a.jsx)(c.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute bottom-24 left-1/2 -translate-x-1/2 z-10 pointer-events-none",children:(0,a.jsxs)("div",{className:"backdrop-blur-xl bg-black/30 border border-white/[0.04] rounded-2xl px-5 py-3 text-center",children:[(0,a.jsx)("p",{className:"text-xs text-neutral-400",children:n?"Connection error: ".concat(n):"Connecting to brain event stream..."}),(0,a.jsx)("p",{className:"text-[10px] text-neutral-600 mt-0.5",children:"Waiting for Molly to come online"})]})})}function en(){let{selectRegion:e,decayActivity:n}=b(),[t,l]=(0,r.useState)(new Set(["hemispheres","cerebellum","brainstem","limbic","basalGanglia","deepStructures"])),[c,d]=(0,r.useState)(!0);!function(){let{setConnected:e,processEvent:n,processHistory:t,setEventsPerSecond:a}=b(),l=(0,r.useRef)(null),s=(0,r.useRef)(null),i=(0,r.useRef)(0),o=(0,r.useRef)(Date.now());(0,r.useEffect)(()=>{let r=!0;!function a(){if(!r)return;l.current&&l.current.close();let o=new EventSource("/api/brain-events/stream");l.current=o,o.onopen=()=>{r&&(e(!0),console.log("[live] Connected to event stream"))},o.onmessage=e=>{if(r)try{let a=JSON.parse(e.data);"history"===a.type?t(a.data):"brain_event"===a.type&&(n(a.data),i.current++)}catch(e){console.error("[live] Failed to parse event:",e)}},o.onerror=()=>{r&&(e(!1,"Connection lost"),o.close(),s.current=setTimeout(()=>{r&&(console.log("[live] Reconnecting..."),a())},3e3))}}();let c=setInterval(()=>{let e=Date.now(),n=(e-o.current)/1e3;n>0&&(a(i.current/n),i.current=0,o.current=e)},1e3);return()=>{r=!1,l.current&&l.current.close(),s.current&&clearTimeout(s.current),clearInterval(c)}},[e,n,t,a])}(),(0,r.useEffect)(()=>{let e=setInterval(()=>{n()},50);return()=>clearInterval(e)},[n]);let p=(0,r.useMemo)(()=>{let e=new Set;for(let n of t)for(let t of w.Jj[n])e.add(t);return e},[t]),m=(0,r.useCallback)(e=>{l(n=>{let t=new Set(n);return t.has(e)?t.delete(e):t.add(e),t})},[]),x=(0,r.useCallback)(()=>{l(new Set(Object.keys(w.Jj)))},[]);return(0,a.jsxs)("div",{className:"h-screen w-screen overflow-hidden bg-[#060609] relative",children:[(0,a.jsxs)(s.Hl,{camera:{position:[0,10,30],fov:40},gl:{antialias:!0,alpha:!0},dpr:[1,2],className:"!absolute inset-0",onPointerMissed:()=>e(null),children:[(0,a.jsx)("color",{attach:"background",args:["#020206"]}),(0,a.jsx)("fog",{attach:"fog",args:["#020206",40,80]}),(0,a.jsx)("ambientLight",{intensity:.08}),(0,a.jsxs)(r.Suspense,{fallback:null,children:[(0,a.jsx)(M,{visibleIds:p,children:(0,a.jsx)(Y,{})}),(0,a.jsx)(i.A,{radius:120,depth:100,count:600,factor:2.5,saturation:.1,fade:!0,speed:.1}),(0,a.jsx)(O,{})]}),(0,a.jsx)(o.N,{makeDefault:!0,enableDamping:!0,dampingFactor:.06,minDistance:12,maxDistance:55,enablePan:!0,target:[0,7,0],rotateSpeed:.5})]}),(0,a.jsx)(W,{panelOpen:c,onTogglePanel:()=>d(e=>!e)}),(0,a.jsx)(K,{activeLayers:t,onToggle:m,onShowAll:x}),(0,a.jsx)(u.N,{children:(0,a.jsx)(ee,{})}),(0,a.jsx)(u.N,{children:c&&(0,a.jsx)(G,{})}),(0,a.jsx)(U,{})]})}}}]);